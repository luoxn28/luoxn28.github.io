<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="该来的终究会来，而且比想象的更快！"><title>kubernetes基础概念 | luoxn28</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">kubernetes基础概念</h1><a id="logo" href="/.">luoxn28</a><p class="description">南</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">kubernetes基础概念</h1><div class="post-meta">Jan 21, 2020<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#k8s基础概念"><span class="toc-number">1.</span> <span class="toc-text">k8s基础概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#几种资源抽象"><span class="toc-number">2.</span> <span class="toc-text">几种资源抽象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#k8s组件"><span class="toc-number">3.</span> <span class="toc-text">k8s组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#master节点"><span class="toc-number">3.1.</span> <span class="toc-text">master节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#node节点"><span class="toc-number">3.2.</span> <span class="toc-text">node节点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#核心组件"><span class="toc-number">3.3.</span> <span class="toc-text">核心组件</span></a></li></ol></li></ol></div></div><div class="post-content"><p>kubernetes（简称k8s）是一种用于在一组主机上运行和协同容器化应用程序的管理平台，皆在提供高可用、高扩展性和可预测性的方式来管理容器应用的生命周期。通过k8s，用户可以定义程序运行方式、部署升级策略、动态伸缩容，使得用户以一种更灵活可靠的方式来管理应用程序。</p>
<blockquote>
<p>关于k8s，是一种对应用服务的打包、部署、监控等一整套生命周期的自动化管理平台，目前各大公司已在生产环境部署使用，同时k8s社区比较活跃，在未来一段时间内会越来越流行，可以说是以后服务部署的事实标准，对于Java开发者来说，你可以不直接使用它，但是不能不了解它。</p>
</blockquote>
<p>总结来看，k8s特点如下：</p>
<ul>
<li><strong>自动装箱</strong>：基于容器，结合调度策略将多种应用部署到同一节点上，提高资源利用率；</li>
<li><strong>自我修复</strong>：支持故障转移/重启，具有健康检查机制；</li>
<li><strong>水平扩展</strong>：通过命令手动执行扩容，可基于CPU等资源负载率来动态实现伸缩容；</li>
<li><strong>服务发现/负载均衡</strong>：通过KubeDNS（或CoreDNS）为系统内置了服务发现功能，为每个service配置DNS名称，service通过iptables或ipvs内建了负载均衡机制；</li>
<li><strong>自动部署</strong>：自动发布和回滚，支持灰度、增量发布等；</li>
<li><strong>配置管理</strong>：ConfigMap实现了配置数据与Docker镜像解耦，为开发部署提供了良好的灵活性；</li>
<li><strong>批处理</strong>：除了管理服务型应用之外，Kubernetes还支持批处理作业及CI（持续集成）。</li>
</ul>
<blockquote>
<p>从k8s的角度看，它把各个待管理的资源进行了抽象，比如针对服务器（物理机或者虚拟机）抽象出Node；对于容器不直接管理而是抽象出Pod来管理容器；对于集群内的服务调用，抽象出service来表示同类型的多个Pod，同时提供负载均衡策略等。</p>
</blockquote>
<p>对于初学者来说，k8s的一些抽象资源和基本概念可能会造成一头雾水，本文就k8s的基础概念和组件进行简单分析，让初学者更快了解k8s概念，话不多说，let‘s go~</p>
<h3 id="k8s基础概念"><a href="#k8s基础概念" class="headerlink" title="k8s基础概念"></a>k8s基础概念</h3><p>k8s使用共享网络将多个物理机（或者虚拟机）汇集到一个集群中，该集群是配置k8s所有组件、功能和工作负载的物理平台。集群中一台服务器会作为master负责管理整个集群（为了master高可用一般会将master部署成多节点）。</p>
<p>Master是集群的网关和中枢，负责诸如为用户和客户端暴露API、跟踪其他服务器的健康状态、以最优方式调度工作负载，以及编排其他组件之间的通信等任务，它是用户/客户端与集群之间的核心联络点，并负责Kubernetes系统的大多数集中式管控逻辑。单个Master节点即可完成其所有的功能，但出于冗余及负载均衡等目的，生产环境中通常需要协同部署多个此类主机。Node是Kubernetes集群的工作节点，负责接收来自Master的工作指令并根据指令相应地创建或销毁Pod对象，以及调整网络规则以合理地路由和转发流量等。理论上讲，Node可以是任何形式的计算设备，不过Master会统一将其抽象为Node对象进行管理。</p>
<h3 id="几种资源抽象"><a href="#几种资源抽象" class="headerlink" title="几种资源抽象"></a>几种资源抽象</h3><ul>
<li><strong>Pod</strong>：k8s管理的最小调度单元，k8s不直接来管理容器，使用一个抽象的资源对象来封装一个或者多个容器，这个抽象即为Pod。同一Pod中的容器共享网络名称空间和存储资源，这些容器可经由本地回环接口lo直接通信，同时对于Mount、User及PID等资源也进行了隔离；</li>
<li><strong>标签资源和标签选择器</strong>：标签（Label）是将资源进行分类的标识符，k8s的Pod资源选择大都是基于标签来的，一个对象可以拥有多个标签，一个标签也可以附加于多个对象（通常是同一类对象）之上。标签选择器（Selector）全称为“Label Selector”，它是一种根据Label来过滤符合条件的资源对象的机制；</li>
<li><strong>Controller</strong>：Pod控制器，尽管Pod是k8s的最小调度单元，但用户通常并不会直接部署及管理Pod对象，而是要借助于另一类抽象——控制器（Controller）对其进行管理，k8s的控制器包括ReplicationController、ReplicaSet、Deployment、StatefulSet、Job等，每种controller都有对应的功能（比如Deployment是最常见的无状态应用的控制器，它支持应用的扩缩容、滚动更新等操作，为容器化应用赋予了极具弹性的功能）；</li>
<li><strong>Service</strong>：Service是建立在一组Pod对象之上的资源抽象，它通过标签选择器选定一组Pod对象，并为这组Pod对象定义一个统一的固定访问入口（通常是一个IP地址）；</li>
<li><strong>存储卷</strong>：一般是独立于容器文件系统之外的存储空间，常用于扩展容器的存储空间并为它提供持久存储能力，大体上可分为临时卷、本地卷和网络卷；</li>
<li><strong>Name和Namespace</strong>：名称是网络资源的唯一标识符，通常在一个命名空间内，名称标识是唯一的，名称空间通常用于实现租户或项目的资源隔离，从而形成逻辑分组；</li>
<li><strong>Ingress</strong>：k8s中将Pod进行了网络隔离，如果需要开放一些Pod供外部使用，则需要一个配置一个流量进入k8s集群内的通道，除了Service外，Ingress也是实现策略之一。</li>
</ul>
<h3 id="k8s组件"><a href="#k8s组件" class="headerlink" title="k8s组件"></a>k8s组件</h3><p>一个典型的k8s集群由master节点、多个工作节点和ETCD组成，其中ETCD作为集群状态存储。master节点负责整个集群的管理工作，为集群提供管理API，并负责编排和监控各工作节点，各工作节点已Pod形式管理运行容器。master主要由apiserver、controller-manager和scheduler三个组件组成，同时负责与ETCD教育存储集群状态数据，而每个工作节点主要包含kubelet、kube-proxy及容器引擎（最常见的是Docker）等组件。各个组件整体如下图：</p>
<p><img src="/2020/01/21/kubernetes-ji-chu-gai-nian/./kubernetes基础概念/image-20200120214102347.png" alt></p>
<h4 id="master节点"><a href="#master节点" class="headerlink" title="master节点"></a>master节点</h4><p>master包含组件如下：</p>
<ul>
<li><strong>API server</strong>：对外提供restful api，k8s集群的网关；</li>
<li><strong>Controller</strong>：Pod控制器，k8s通过控制器来管理Pod资源，控制器包括ReplicationController、ReplicaSet、Deployment、StatefulSet、Job等，每种controller都有对应的功能（比如Deployment是最常见的无状态应用的控制器，它支持应用的扩缩容、滚动更新等操作，为容器化应用赋予了极具弹性的功能）；</li>
<li><strong>Scheduler</strong>：K8s调度器，K8s管理成千上万容器资源，api server接收到请求之后就由Scheduler按照对应调度策略进行在不同Node间的请求调度操作；</li>
<li><strong>ETCD</strong>：k8s集群状态都是存储在etcd中（通过API Server共享给集群的各组件及客户端），通过etcd的watch机制来进行k8s各组件的协同操作，一般etcd通过集群部署方式保证高可用。</li>
</ul>
<h4 id="node节点"><a href="#node节点" class="headerlink" title="node节点"></a>node节点</h4><p>node节点接受master的管理，负责管理各个Pod资源：</p>
<ul>
<li><strong>kubelet</strong>：kubelet是node的守护进程，node接受master的管控，Kubelet会向api server注册当前node，定期向master会报node资源占用情况；</li>
<li><strong>容器运行环境</strong>：node会提供一个容器运行环境，负责下载并运行容器，k8s目前支持的容器运行环境包括Docker、RKT、cri-o和Fraki等；</li>
<li><strong>kube-proxy</strong>：每个node都需要一个kube-proxy进程，比如对service按需生成iptables或ipvs规则，控制流量访问。</li>
</ul>
<h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><p>k8s除了etcd、master、node这几个组件之外，还有一些核心组件，如下：</p>
<ul>
<li><strong>DNS服务</strong>：目前k8s使用的是coreDNS，之前使用的是KubeDNS；</li>
<li><strong>Kubernetes Dashboard</strong>：k8s的管理web UI；</li>
<li><strong>Heapster</strong>：容器和节点的性能监控与分析系统，它收集并解析多种指标数据，如资源利用率、生命周期事件等。新版本的Kubernetes中，其功能会逐渐由Prometheus结合其他组件所取代。</li>
<li><strong>Ingress Controller</strong>:Service是一种工作于传统层的负载均衡器，而Ingress是在应用层实现的HTTP（s）负载均衡机制。不过，Ingress资源自身并不能进行“流量穿透”，它仅是一组路由规则的集合，这些规则需要通过Ingress控制器（Ingress Controller）发挥作用。目前，此类的可用项目有Nginx、Traefik、Envoy及HAProxy等。</li>
</ul>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>luoxn28</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/01/21/kubernetes-ji-chu-gai-nian/">http://luoxn28.github.io/2020/01/21/kubernetes-ji-chu-gai-nian/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本文章著作权归作者所有，任何形式的转载都请注明出处。</li></ul></div><br><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://luoxn28.github.io/2020/01/21/kubernetes-ji-chu-gai-nian/" data-id="ck8obhpsj001sc7ci3kohh49p" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACqklEQVR42u3aQW7jMBAEQP//07vXBRayu2fIwAhKJ0NxRJYCcJgevl7x9eef6+mnT3dmn/8f8Wn0AxceHh7eYurvH/3+TsI+9bRkznh4eHi3ecnj8jLwYch4rM138PDw8L6Ht5ni+4KUfwcPDw/vd/DaySUb6Lw44eHh4f08Lwkj3k/u6U4b3bbhxbGsBQ8PDy/m5Uv893y+0t/Dw8PDW3fV8wW3bZ61y/1wtnh4eHgXeLPINWl95aHDPur9ME88PDy8C7x8cvkBglnZaOOGoj2Gh4eHd4iXb3bzxfpUHJyXk6IY4OHh4a15+/xzEyKcaq3VDTA8PDy8Q7xku5w8blM2Zot+8RfDw8PD+xFesrFuh8x/a9MSw8PDw7vBy4PRfdTblopZpFsk03h4eHgjXrtYzxpXsyMIp2JlPDw8vLO8zRKfHyBoY9z968DDw8O7x0uos0327GBWXlrqAAUPDw/vEK84TXBo45u/ynaFP3AaCw8PDy+e/ywwbaPbvJHWFpsPVDw8PLyjvLZZNSsJeUjxiq8IiYeHh3eB1wav+SK+CWdnse/jiHh4eHjXeMmynh+iaiPa9gXlpQIPDw/vLG8/TBsT7MsMHh4e3jfwhseYyjLQPnlzQAEPDw/vHi9fuPMmVvudWZHIfwsPDw/vHm9zGCun5nFGcj9qoeHh4eFd4+UTarfObUNr1vqKGmB4eHh4R3mzI037IwWz8lNEJHh4eHhHefsYot0ob2LiNvLAw8PDu8HbRAx5WDCLHk616PDw8PBu8PLG0v4VzA4K5KFJ3d/Dw8PDW/DaRXnfuMq34IezFjw8PLwv4LWx7yzOyPF4eHh438/bIE8dLHicAx4eHt41XjJMWx7yltWmJHwYBQ8PD+8Cr/73PhgmLy0J5sbBLDw8PLwR7y+l732CYIc9NQAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/kubernetes/">kubernetes</a></div><div class="post-nav"><a class="pre" href="/2020/01/28/influxdb-de-ming-ling-men/">influxdb的命令们</a><a class="next" href="/2020/01/21/docker-wang-luo-tong-xin/">Docker网络通信</a></div><div id="container"></div><link rel="stylesheet" type="text/css" href="//unpkg.com/gitalk/dist/gitalk.css?v=0.0.0"><script type="text/javascript" src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=0.0.0"></script><script type="text/javascript" src="//unpkg.com/gitalk/dist/gitalk.min.js?v=0.0.0"></script><script>var gitalk = new Gitalk({
  clientID: '0eda0c4ea18dd9042b41',
  clientSecret: 'df032ab700b83adbcaaf2f74eee0004c1ada25df',
  repo: 'luoxn28.github.io.gittalk',
  owner: 'luoxn28',
  admin: ['luoxn28'],
  id: md5(location.pathname),
  distractionFreeMode: false
})
gitalk.render('container')
</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/分布式/">分布式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/操作系统/">操作系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/框架研究/">框架研究</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/netty/" style="font-size: 15px;">netty</a> <a href="/tags/redis/" style="font-size: 15px;">redis</a> <a href="/tags/influxdb/" style="font-size: 15px;">influxdb</a> <a href="/tags/kubernetes/" style="font-size: 15px;">kubernetes</a> <a href="/tags/sentinel/" style="font-size: 15px;">sentinel</a> <a href="/tags/线上问题/" style="font-size: 15px;">线上问题</a> <a href="/tags/dubbo/" style="font-size: 15px;">dubbo</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/03/31/ye-shi-nei-cun-guan-li/">页式内存管理</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/17/group-by-zhong-zi-cha-xun-order-by-pai-xu-shi-xiao-wen-ti-fen-xi/">group by中子查询order by排序失效问题分析</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/16/transmittable-thread-local-xian-cheng-jian-shang-xia-wen-chuan-di-jie-jue-fang-an/">Transmittable-Thread-Local：线程间上下文传递解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/13/xian-cheng-chi-ru-he-chuan-di-xian-cheng-shang-xia-wen-xin-xi/">线程池如何传递线程上下文信息</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/03/08/tostring-ru-he-fan-xu-lie-hua/">ToString如何反序列化</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/29/java-bing-fa-gong-ju-lei/">Java并发工具类</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/19/yi-qi-liao-liao-3-ge-xian-cheng-yi-ci-da-yin-1-2-3-de-gu-shi/">一起聊聊3个线程依次打印1、2、3的故事</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/08/kubernetes-zhi-pod-na-xie-shi/">kubernetes之Pod那些事</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/28/influxdb-ru-men/">influxdb入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/28/influxdb-yuan-li-na-xie-shi/">influxdb原理那些事</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">luoxn28.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>